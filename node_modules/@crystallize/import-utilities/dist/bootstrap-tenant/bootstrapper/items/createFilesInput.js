"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createFilesInput = void 0;
const utils_1 = require("../utils");
async function createFilesInput(props) {
    var _a;
    const { files, language, context, onUpdate } = props;
    const fs = [];
    for (let i = 0; i < (files === null || files === void 0 ? void 0 : files.length); i++) {
        const file = files[i];
        let { key } = file;
        if (!key) {
            try {
                const uploadResult = await context.uploadFileFromUrl(file.src);
                if (uploadResult) {
                    key = uploadResult.key;
                    // Store the values so that we don't re-upload again during import
                    file.key = uploadResult.key;
                }
            }
            catch (e) {
                onUpdate({
                    error: {
                        code: 'UPLOAD_FAILED',
                        message: `Could not upload file "${JSON.stringify(file)}". Reason: ${(_a = e.message) !== null && _a !== void 0 ? _a : 'unknown'}`,
                    },
                });
            }
        }
        if (key) {
            fs.push({
                key,
                title: (0, utils_1.getTranslation)(file.title, language),
            });
        }
    }
    return fs;
}
exports.createFilesInput = createFilesInput;
